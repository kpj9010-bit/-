<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¶˜ì²œ ì¥ë¡€ì‹ì¥ ë¹ˆì†Œí˜„í™©</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@600;700&family=Noto+Sans+KR:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#eae7e1;--card:#ffffff;--t1:#1e1e1e;--t2:#52524e;--t3:#8c8480;
  --accent:#4a6e5c;--accent-light:#eaf2ee;--border:#e2ddd7;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;-webkit-font-smoothing:antialiased}

.header{position:sticky;top:0;z-index:50;background:var(--card);border-bottom:1px solid var(--border);box-shadow:0 1px 8px rgba(0,0,0,.04);padding:18px 16px 14px;text-align:center}
.header h1{font-family:'Noto Serif KR',serif;font-size:1.18rem;font-weight:700;letter-spacing:-.3px;margin-bottom:2px}
.header .sub{font-size:.7rem;color:var(--t3);font-weight:300}

.tabs{display:flex;gap:6px;padding:12px 12px 0;max-width:720px;margin:0 auto;overflow-x:auto;scrollbar-width:none;-webkit-overflow-scrolling:touch}
.tabs::-webkit-scrollbar{display:none}
.tab{flex-shrink:0;display:inline-flex;align-items:center;gap:5px;background:var(--card);border:1px solid var(--border);border-radius:20px;padding:6px 13px;font-size:.74rem;font-weight:500;color:var(--t2);cursor:pointer;white-space:nowrap;transition:all .18s;user-select:none}
.tab:hover{border-color:#b5ccc0}
.tab.active{background:var(--accent);border-color:var(--accent);color:#fff}

.content{max-width:720px;margin:12px auto 60px;padding:0 12px}
.parlor-card{display:none;background:var(--card);border-radius:14px;box-shadow:0 2px 16px rgba(0,0,0,.05);overflow:hidden;animation:pop .2s ease}
.parlor-card.show{display:block}
@keyframes pop{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

.card-header{padding:14px 16px 10px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);background:#fafaf8}
.card-header h2{font-family:'Noto Serif KR',serif;font-size:.96rem;font-weight:600}
.card-header .info{display:flex;flex-direction:column;gap:3px;align-items:flex-end}
.card-header .tel{font-size:.72rem;color:var(--t3)}
.card-header .tel a{color:var(--accent);text-decoration:none;font-weight:500}
.card-header .tel a:hover{text-decoration:underline}
.card-header .link-btn{display:inline-flex;align-items:center;gap:4px;font-size:.68rem;color:var(--accent);text-decoration:none;padding:4px 8px;border-radius:6px;background:var(--accent-light);transition:all .15s}
.card-header .link-btn:hover{background:var(--accent);color:#fff}
.card-header .link-btn svg{width:11px;height:11px}

.iframe-wrap{width:100%;background:#faf8f5;position:relative;min-height:320px}
.iframe-wrap iframe{width:100%;height:100%;min-height:400px;border:none;display:block}

.card-footer{padding:10px 16px;border-top:1px solid var(--border);background:#fdfcfa;display:flex;align-items:center;gap:12px;font-size:.7rem;color:var(--t3)}
.card-footer .addr{flex:1}

.updating{padding:48px 20px;text-align:center}
.updating .icon{width:52px;height:52px;background:#fef3e2;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px}
.updating .icon svg{width:24px;height:24px;color:#d4883a}
.updating h3{font-size:.92rem;font-weight:600;margin-bottom:6px}
.updating p{font-size:.78rem;color:var(--t3);line-height:1.6}

/* âœ… í˜¸ë°˜ JSON í‘œì‹œ ìŠ¤íƒ€ì¼ */
.hoban-meta{font-size:.72rem;color:var(--t3);margin-bottom:10px}
.hoban-list{display:flex;flex-direction:column;gap:10px}
.hoban-item{
  background:#fff;border:1px solid var(--border);border-radius:12px;
  padding:12px;box-shadow:0 1px 10px rgba(0,0,0,.04);
}
.hoban-top{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
.hoban-room{font-weight:800;color:var(--t1)}
.hoban-memo{font-size:.72rem;color:var(--t3)}
.hoban-name{margin-top:6px;font-size:.9rem;font-weight:700}
.hoban-sub{margin-top:6px;font-size:.76rem;color:var(--t2);line-height:1.5}
.hoban-error{
  display:none;margin-top:12px;padding:12px;border:1px solid var(--border);
  border-radius:10px;background:#fff;
}
.hoban-error .t{font-weight:700;margin-bottom:6px}
.hoban-error .d{font-size:.82rem;color:var(--t3);line-height:1.55}
.hoban-error a{
  display:inline-block;margin-top:10px;background:var(--accent);color:#fff;
  padding:10px 14px;border-radius:10px;text-decoration:none;font-weight:700;
}

@media(max-width:500px){
  .header{padding:16px 14px 14px}
  .header h1{font-size:1.1rem}
  .card-header{flex-direction:column;align-items:flex-start;gap:6px;padding:12px 14px 10px}
  .card-header .info{align-items:flex-start}
}
</style>
</head>
<body>

<div class="header">
  <h1>ì¶˜ì²œ ì¥ë¡€ì‹ì¥ ë¹ˆì†Œí˜„í™©</h1>
  <span class="sub">ì‹¤ì‹œê°„ ë¹ˆì†Œ í˜„í™© í™•ì¸</span>
</div>

<div class="tabs">
  <button class="tab active" onclick="switchTab(0)">ì¶˜ì²œì¥ë¡€ì‹ì¥</button>
  <button class="tab" onclick="switchTab(1)">ê°•ì›íš¨ì¥ë¡€ë¬¸í™”ì›</button>
  <button class="tab" onclick="switchTab(2)">í˜¸ë°˜ë³‘ì›ì¥ë¡€ì‹ì¥</button>
  <button class="tab" onclick="switchTab(3)">ê°•ì›ëŒ€í•™êµë³‘ì›</button>
  <button class="tab" onclick="switchTab(4)">ì‹œë¯¼ì¥ë¡€ì‹ì¥</button>
</div>

<div class="content">

  <!-- 0. ì¶˜ì²œì¥ë¡€ì‹ì¥ -->
  <div class="parlor-card show" id="card-0">
    <div class="card-header">
      <h2>ì¶˜ì²œì¥ë¡€ì‹ì¥</h2>
      <div class="info">
        <span class="tel">ğŸ“ <a href="tel:033-256-4444">033-256-4444</a></span>
        <a href="https://e-iris.co.kr/display/parlor/iframe/324" target="_blank" class="link-btn">
          ì›ë³¸ í˜ì´ì§€
          <svg viewBox="0 0 12 12" fill="none"><path d="M8 2h2v2M5.5 6.5l5-5M9 6.5v3.2C9 10.2 8.2 11 7.2 11H2.8C1.8 11 1 10.2 1 9.2V4.8C1 3.8 1.8 3 2.8 3H5.5" stroke="currentColor" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </a>
      </div>
    </div>
    <div class="iframe-wrap">
      <iframe id="frame-0" src="https://e-iris.co.kr/display/parlor/iframe/324" scrolling="yes"></iframe>
    </div>
    <div class="card-footer">
      <span class="addr">ğŸ“ ë™ë©´ ì†Œì–‘ê°•ë¡œ 409</span>
    </div>
  </div>

  <!-- 1. ê°•ì›íš¨ì¥ë¡€ë¬¸í™”ì› -->
  <div class="parlor-card" id="card-1">
    <div class="card-header">
      <h2>ê°•ì›íš¨ì¥ë¡€ë¬¸í™”ì›</h2>
      <div class="info">
        <span class="tel">ğŸ“ <a href="tel:033-261-4441">033-261-4441</a></span>
        <a href="https://e-baro.co.kr/api_view/?code=icBnKH" target="_blank" class="link-btn">
          ì›ë³¸ í˜ì´ì§€
          <svg viewBox="0 0 12 12" fill="none"><path d="M8 2h2v2M5.5 6.5l5-5M9 6.5v3.2C9 10.2 8.2 11 7.2 11H2.8C1.8 11 1 10.2 1 9.2V4.8C1 3.8 1.8 3 2.8 3H5.5" stroke="currentColor" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </a>
      </div>
    </div>
    <div class="iframe-wrap">
      <iframe id="frame-1" src="https://e-baro.co.kr/api_view/?code=icBnKH" scrolling="yes"></iframe>
    </div>
    <div class="card-footer">
      <span class="addr">ğŸ“ ë™ë‚´ë©´ ìˆœí™˜ëŒ€ë¡œ 877</span>
    </div>
  </div>

  <!-- 2. í˜¸ë°˜ë³‘ì›ì¥ë¡€ì‹ì¥ (âœ… data.jsonì„ ì½ì–´ í‘œì‹œ) -->
  <div class="parlor-card" id="card-2">
    <div class="card-header">
      <h2>í˜¸ë°˜ë³‘ì›ì¥ë¡€ì‹ì¥</h2>
      <div class="info">
        <span class="tel">ğŸ“ <a href="tel:033-252-0046">033-252-0046</a></span>

        <a href="https://www.hobanfuneral.co.kr/index.php?listStyle=webzine&mid=sub43&sort_index=var1&order_type=asc"
           target="_blank" class="link-btn">
          ì›ë³¸ í˜ì´ì§€
          <svg viewBox="0 0 12 12" fill="none"><path d="M8 2h2v2M5.5 6.5l5-5M9 6.5v3.2C9 10.2 8.2 11 7.2 11H2.8C1.8 11 1 10.2 1 9.2V4.8C1 3.8 1.8 3 2.8 3H5.5" stroke="currentColor" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </a>
      </div>
    </div>

    <div class="iframe-wrap" style="padding:12px;min-height:320px">
      <div class="hoban-meta" id="hobanMeta">í˜¸ë°˜ ë¹ˆì†Œí˜„í™© ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      <div class="hoban-list" id="hobanList"></div>

      <div class="hoban-error" id="hobanError">
        <div class="t">í˜¸ë°˜ ë¹ˆì†Œí˜„í™©ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</div>
        <div class="d">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</div>
        <a href="https://www.hobanfuneral.co.kr/index.php?listStyle=webzine&mid=sub43&sort_index=var1&order_type=asc"
           target="_blank" rel="noopener">ğŸ‘‰ ì›ë³¸ í˜ì´ì§€ ì—´ê¸°</a>
      </div>
    </div>

    <div class="card-footer">
      <span class="addr">ğŸ“ ì‚¼ì²œë™ ì˜›ê²½ì¶˜ë¡œ 663</span>
    </div>
  </div>

  <!-- 3. ê°•ì›ëŒ€í•™êµë³‘ì›ì¥ë¡€ì‹ì¥ -->
  <div class="parlor-card" id="card-3">
    <div class="card-header">
      <h2>ê°•ì›ëŒ€í•™êµë³‘ì›ì¥ë¡€ì‹ì¥</h2>
      <div class="info">
        <span class="tel">ğŸ“ <a href="tel:033-254-5611">033-254-5611</a></span>
        <a href="https://m.knuh.or.kr/hospitalinfor/funeral_01.asp" target="_blank" class="link-btn">
          ì›ë³¸ í˜ì´ì§€
          <svg viewBox="0 0 12 12" fill="none"><path d="M8 2h2v2M5.5 6.5l5-5M9 6.5v3.2C9 10.2 8.2 11 7.2 11H2.8C1.8 11 1 10.2 1 9.2V4.8C1 3.8 1.8 3 2.8 3H5.5" stroke="currentColor" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </a>
      </div>
    </div>
    <div class="iframe-wrap">
      <iframe id="kangwonFrame" src="https://m.knuh.or.kr/hospitalinfor/funeral_01.asp" scrolling="yes"></iframe>
    </div>
    <div class="card-footer">
      <span class="addr">ğŸ“ íš¨ìë™ ë°±ë ¹ë¡œ 156</span>
    </div>
  </div>

  <!-- 4. ì‹œë¯¼ì¥ë¡€ì‹ì¥ -->
  <div class="parlor-card" id="card-4">
    <div class="card-header">
      <h2>ì¶˜ì²œ ì‹œë¯¼ì¥ë¡€ì‹ì¥</h2>
    </div>
    <div class="updating">
      <div class="icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
          <circle cx="12" cy="12" r="9"/>
          <path d="M12 6v6l4 2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h3>ë¹ˆì†Œí˜„í™© ì—…ë°ì´íŠ¸ ì¤‘</h3>
      <p>í˜„ì¬ ë¹ˆì†Œí˜„í™© ì •ë³´ê°€ ì—…ë°ì´íŠ¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.<br>ì ì‹œ í›„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
    </div>
    <div class="card-footer">
      <span class="addr">ğŸ“ ì¶˜ì²œì‹œ ì‹œë¯¼ì¥ë¡€ì‹ì¥</span>
    </div>
  </div>

</div>

<script>
function switchTab(idx) {
  document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === idx));
  document.querySelectorAll('.parlor-card').forEach((c, i) => c.classList.toggle('show', i === idx));
  if (idx === 2) loadHobanData(); // âœ… í˜¸ë°˜ íƒ­ì—ì„œ data.json ë¡œë“œ
}

// âœ… í˜¸ë°˜ data.json ë¡œë“œ + "ì–´ë–¤ êµ¬ì¡°ë“ " ê°ì²´ ë°°ì—´ ìë™ íƒìƒ‰ í›„ ë Œë”
async function loadHobanData(){
  const meta = document.getElementById('hobanMeta');
  const list = document.getElementById('hobanList');
  const err  = document.getElementById('hobanError');

  if (!meta || !list || !err) return;

  err.style.display = 'none';
  meta.textContent = 'í˜¸ë°˜ ë¹ˆì†Œí˜„í™© ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
  list.innerHTML = '';

  const isObj = (v) => v && typeof v === 'object' && !Array.isArray(v);

  function scoreRows(rows){
    const keys = new Set();
    rows.slice(0, 5).forEach(r => Object.keys(r || {}).forEach(k => keys.add(String(k))));
    const keyStr = Array.from(keys).join(' ');
    const keywords = ['ë¹ˆì†Œ','í˜¸ì‹¤','ê³ ì¸','ê³ ì¸ëª…','ë°œì¸','ì…ê´€','ìƒì£¼','ë³„ì„¸','ì¥ì§€','ìš´êµ¬'];
    let s = 0;
    keywords.forEach(w => { if (keyStr.includes(w)) s += 2; });
    s += Math.min(keys.size, 30) / 10;
    return s;
  }

  function findFirstObjectArray(root, maxDepth = 7){
    const queue = [{ v: root, depth: 0, path: '$' }];
    let best = null;

    while(queue.length){
      const { v, depth, path } = queue.shift();
      if (depth > maxDepth || v == null) continue;

      if (Array.isArray(v)) {
        const objItems = v.filter(x => isObj(x));
        if (objItems.length >= 1) {
          const score = scoreRows(objItems);
          if (!best || score > best.score) best = { rows: objItems, score, path };
        }
        for (let i=0;i<v.length;i++){
          queue.push({ v: v[i], depth: depth+1, path: `${path}[${i}]` });
        }
        continue;
      }

      if (isObj(v)) {
        for (const k of Object.keys(v)) {
          queue.push({ v: v[k], depth: depth+1, path: `${path}.${k}` });
        }
      }
    }
    return best?.rows || [];
  }

  function findUpdatedAt(root){
    const candidates = [];
    const queue = [root];
    let guard = 0;

    while(queue.length && guard++ < 2000){
      const v = queue.shift();
      if (v == null) continue;

      if (typeof v === 'string') {
        if (/\d{4}[-./]\d{1,2}[-./]\d{1,2}/.test(v) || /KST|UTC|\d{1,2}:\d{2}/.test(v)) {
          candidates.push(v);
        }
      } else if (Array.isArray(v)) {
        v.forEach(x => queue.push(x));
      } else if (isObj(v)) {
        for (const k of Object.keys(v)) {
          if (['updatedAt','updated_at','time','timestamp','date','updated'].includes(k)) {
            if (typeof v[k] === 'string') candidates.unshift(v[k]);
          }
          queue.push(v[k]);
        }
      }
    }
    return candidates[0] || 'ì•Œ ìˆ˜ ì—†ìŒ';
  }

  function esc(s){
    return String(s ?? '').replace(/[&<>"']/g, m => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[m]));
  }

  try{
    // âœ… íŒŒì¼ì´ ë£¨íŠ¸ì— ìˆëŠ” ê²½ìš°/ì„œë¸Œí´ë”ì¸ ê²½ìš° ëª¨ë‘ ëŒ€ë¹„: í˜„ì¬ URL ê¸°ì¤€ìœ¼ë¡œ ìƒì„±
    const base = new URL(location.href);
    base.hash = '';
    base.search = '';
    const url = new URL('data.json', base).toString() + '?ts=' + Date.now();

    const res = await fetch(url, { cache: 'no-store' });
    if(!res.ok) throw new Error('HTTP ' + res.status);
    const data = await res.json();

    const updatedAt = findUpdatedAt(data);
    const rows = findFirstObjectArray(data, 7);

    meta.textContent = `ì—…ë°ì´íŠ¸: ${updatedAt} / ì´ ${rows.length}ê±´`;

    if(rows.length === 0){
      list.innerHTML = `<div class="hoban-item" style="color:var(--t3);font-size:.82rem;">
        í˜„ì¬ í‘œì‹œí•  ë¹ˆì†Œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.
      </div>`;
      return;
    }

    rows.forEach((r) => {
      const obj = r || {};
      const room   = obj.room || obj.hall || obj["ë¹ˆì†Œ"] || obj["í˜¸ì‹¤"] || obj["ë¹ˆì†Œëª…"] || '';
      const name   = obj.name || obj.deceased || obj["ê³ ì¸"] || obj["ê³ ì¸ëª…"] || obj["ì„±ëª…"] || '';
      const death  = obj.death || obj["ë³„ì„¸"] || obj["ì…ê´€"] || obj["ì…ê´€ì¼ì‹œ"] || '';
      const coffin = obj.coffin || obj["ë°œì¸"] || obj["ë°œì¸ì¼ì‹œ"] || obj["ì…ê´€/ë°œì¸"] || '';
      const memo   = obj.memo || obj.family || obj["ìƒì£¼"] || obj["ë¹„ê³ "] || obj["ì¥ì§€"] || '';

      const div = document.createElement('div');
      div.className = 'hoban-item';
      div.innerHTML = `
        <div class="hoban-top">
          <div class="hoban-room">${esc(room)}</div>
          <div class="hoban-memo">${esc(memo)}</div>
        </div>
        <div class="hoban-name">${esc(name)}</div>
        <div class="hoban-sub">
          ${death ? `ì •ë³´: ${esc(death)}<br>` : ``}
          ${coffin ? `ì¼ì •: ${esc(coffin)}` : ``}
        </div>
      `;
      list.appendChild(div);
    });

  }catch(e){
    meta.textContent = 'ì—…ë°ì´íŠ¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
    err.style.display = 'block';
  }
}

// âœ… 10ë¶„ë§ˆë‹¤ â€œí˜„ì¬ ë³´ê³  ìˆëŠ” íƒ­â€ ìë™ ìƒˆë¡œê³ ì¹¨ (í˜¸ë°˜ì€ JSON ì¬ë¡œë”©)
setInterval(() => {
  const visible = document.querySelector('.parlor-card.show iframe');
  if (visible) visible.src = visible.src;

  const hobanCard = document.getElementById('card-2');
  if (hobanCard && hobanCard.classList.contains('show')) loadHobanData();
}, 600000);
</script>

</body>
</html>
